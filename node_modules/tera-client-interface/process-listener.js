const { snapshot } = require("process-list");

let ListedProcesses = [];

module.exports = function ProcessListener(Name, OnAdded, OnRemoved, Interval) {
    snapshot("pid", "ppid", "name", "path").then(processes => {
        const NewListedProcesses = [];
        for (const process of processes) {
            if (process.name.toUpperCase() === Name.toUpperCase() && !ListedProcesses.includes(process.ppid)) {
                if (!ListedProcesses.includes(process.pid)) {
                    OnAdded(process);
                }
                NewListedProcesses.push(process.pid)
            }
        }

        for (const pid in ListedProcesses) {
            if (!NewListedProcesses.includes(pid))
                OnRemoved(pid);
        }
        ListedProcesses = NewListedProcesses;
        setTimeout(() => ProcessListener(Name, OnAdded, OnRemoved, Interval), Interval);
    });
}
